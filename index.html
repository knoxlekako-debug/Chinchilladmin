<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Administración</title>
    <style>
        :root {
            --primary-color: #6BBE66; /* Verde manzana */
            --secondary-color: #50514F; /* Gris plomo */
            --light-color: #f5f5f5;
            --dark-color: #333;
            --white-color: #ffffff;
            --accent-color: #4CAF50;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background-color: var(--secondary-color);
            color: var(--white-color);
            line-height: 1.6;
        }
        
        .container {
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
            padding: 10px;
        }
        
        .card {
            background-color: var(--secondary-color);
            border: 1px solid var(--primary-color);
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .header {
            background-color: var(--primary-color);
            color: var(--secondary-color);
            padding: 15px;
            text-align: center;
            border-radius: 8px 8px 0 0;
            font-weight: bold;
        }
        
        .btn {
            display: inline-block;
            background-color: var(--primary-color);
            color: var(--secondary-color);
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            text-decoration: none;
            font-size: 14px;
            margin: 5px;
            transition: all 0.3s;
            font-weight: bold;
        }
        
        .btn:hover {
            background-color: var(--accent-color);
            color: var(--white-color);
        }
        
        .btn-danger {
            background-color: #e74c3c;
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
        }
        
        .btn-success {
            background-color: var(--accent-color);
            color: white;
        }
        
        .btn-success:hover {
            background-color: #3d8b40;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--primary-color);
            border-radius: 4px;
            font-size: 14px;
            background-color: rgba(255, 255, 255, 0.9);
            color: var(--secondary-color);
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .table th, .table td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid var(--primary-color);
            font-size: 14px;
        }
        
        .table th {
            background-color: var(--primary-color);
            color: var(--secondary-color);
        }
        
        .table tr:nth-child(even) {
            background-color: rgba(107, 190, 102, 0.1);
        }
        
        .table input {
            width: 100%;
            border: none;
            background: transparent;
            color: var(--white-color);
        }
        
        .table input:focus {
            outline: 1px solid var(--primary-color);
            background: rgba(107, 190, 102, 0.2);
        }
        
        .nav-tabs {
            display: flex;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--primary-color);
            overflow-x: auto;
        }
        
        .nav-tab {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            margin-right: 5px;
            white-space: nowrap;
            color: var(--white-color);
        }
        
        .nav-tab.active {
            border-bottom: 2px solid var(--primary-color);
            color: var(--primary-color);
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .datetime {
            text-align: center;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 15px;
            padding: 10px;
            background-color: rgba(107, 190, 102, 0.2);
            border-radius: 4px;
            border: 1px solid var(--primary-color);
        }
        
        .hidden {
            display: none;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px;
            background-color: var(--primary-color);
            color: var(--secondary-color);
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            transition: opacity 0.3s;
            font-weight: bold;
        }
        
        .notification.error {
            background-color: #e74c3c;
            color: white;
        }
        
        .notification.warning {
            background-color: #f39c12;
            color: var(--secondary-color);
        }
        
        .summary-section {
            margin-top: 20px;
            padding: 15px;
            background-color: rgba(107, 190, 102, 0.1);
            border-radius: 4px;
            border: 1px solid var(--primary-color);
        }
        
        .summary-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--primary-color);
        }
        
        .tools-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
        }
        
        .calculator {
            background-color: rgba(107, 190, 102, 0.2);
            border: 1px solid var(--primary-color);
            border-radius: 8px;
            padding: 10px;
            width: 250px;
        }
        
        .calculator-display {
            width: 100%;
            height: 40px;
            margin-bottom: 10px;
            padding: 5px;
            text-align: right;
            font-size: 18px;
            background-color: rgba(255, 255, 255, 0.9);
            color: var(--secondary-color);
            border: 1px solid var(--primary-color);
            border-radius: 4px;
        }
        
        .calculator-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 5px;
        }
        
        .calc-btn {
            padding: 10px;
            background-color: var(--primary-color);
            color: var(--secondary-color);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.2s;
        }
        
        .calc-btn:hover {
            background-color: var(--accent-color);
            color: var(--white-color);
        }
        
        .calc-btn.operator {
            background-color: var(--accent-color);
            color: var(--white-color);
        }
        
        .calc-btn.equals {
            background-color: #3498db;
            color: white;
        }
        
        .calc-btn.clear {
            background-color: #e74c3c;
            color: white;
        }
        
        .dollar-link {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: bold;
            padding: 8px 12px;
            border: 1px solid var(--primary-color);
            border-radius: 4px;
            transition: all 0.3s;
        }
        
        .dollar-link:hover {
            background-color: var(--primary-color);
            color: var(--secondary-color);
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 5px;
            }
            
            .card {
                padding: 10px;
            }
            
            .table th, .table td {
                padding: 5px;
                font-size: 12px;
            }
            
            .btn {
                padding: 8px 12px;
                font-size: 12px;
            }
            
            .calculator {
                width: 100%;
                max-width: 300px;
            }
            
            .tools-container {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Login Section -->
        <div id="loginSection" class="container">
            <div class="card">
                <div class="header">
                    <h2>Sistema de Administración</h2>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label for="username">Usuario</label>
                        <input type="text" id="username" class="form-control" placeholder="Ingrese su usuario">
                    </div>
                    <div class="form-group">
                        <label for="password">Contraseña</label>
                        <input type="password" id="password" class="form-control" placeholder="Ingrese su contraseña">
                    </div>
                    <button id="loginBtn" class="btn">Iniciar Sesión</button>
                </div>
            </div>
        </div>

        <!-- Main Application -->
        <div id="mainSection" class="container hidden">
            <div class="card">
                <div class="header">
                    <h2>Sistema de Administración</h2>
                    <div id="currentDateTime" class="datetime"></div>
                </div>
                
                <div class="card-body">
                    <div class="nav-tabs">
                        <div class="nav-tab active" data-tab="general">General</div>
                        <div class="nav-tab" data-tab="expenses">Gastos</div>
                        <div class="nav-tab" data-tab="employees">Empleados</div>
                        <div class="nav-tab" data-tab="changePassword">Cambiar Contraseña</div>
                        <div class="nav-tab" data-tab="summary">Resumen del Día</div>
                    </div>
                    
                    <!-- General Tab -->
                    <div id="generalTab" class="tab-content active">
                        <h3>Registro General</h3>
                        <div class="tools-container">
                            <button id="addRowGeneral" class="btn btn-success">Agregar Fila</button>
                            <div class="calculator">
                                <input type="text" id="calcDisplayGeneral" class="calculator-display" readonly>
                                <div class="calculator-buttons">
                                    <button class="calc-btn clear" data-calc="clear">C</button>
                                    <button class="calc-btn" data-calc="(">(</button>
                                    <button class="calc-btn" data-calc=")">)</button>
                                    <button class="calc-btn operator" data-calc="/">/</button>
                                    <button class="calc-btn" data-calc="7">7</button>
                                    <button class="calc-btn" data-calc="8">8</button>
                                    <button class="calc-btn" data-calc="9">9</button>
                                    <button class="calc-btn operator" data-calc="*">×</button>
                                    <button class="calc-btn" data-calc="4">4</button>
                                    <button class="calc-btn" data-calc="5">5</button>
                                    <button class="calc-btn" data-calc="6">6</button>
                                    <button class="calc-btn operator" data-calc="-">-</button>
                                    <button class="calc-btn" data-calc="1">1</button>
                                    <button class="calc-btn" data-calc="2">2</button>
                                    <button class="calc-btn" data-calc="3">3</button>
                                    <button class="calc-btn operator" data-calc="+">+</button>
                                    <button class="calc-btn" data-calc="0">0</button>
                                    <button class="calc-btn" data-calc=".">.</button>
                                    <button class="calc-btn equals" data-calc="=">=</button>
                                    <button class="calc-btn operator" data-calc="sqrt">√</button>
                                </div>
                            </div>
                            <a href="https://p2p.binance.com/trade/all-payments/USDT?fiat=VES" target="_blank" class="dollar-link">Precio del dólar hoy</a>
                        </div>
                        <div style="overflow-x: auto;">
                            <table id="generalTable" class="table">
                                <thead>
                                    <tr>
                                        <th>Material</th>
                                        <th>Tipo</th>
                                        <th>Cantidad</th>
                                        <th>Precio</th>
                                        <th>Recibido por</th>
                                        <th>Dentino final</th>
                                        <th>Precio Ves</th>
                                        <th>Precio USD</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Rows will be added dynamically -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Expenses Tab -->
                    <div id="expensesTab" class="tab-content">
                        <h3>Registro de Gastos</h3>
                        <div class="tools-container">
                            <button id="addRowExpenses" class="btn btn-success">Agregar Fila</button>
                            <div class="calculator">
                                <input type="text" id="calcDisplayExpenses" class="calculator-display" readonly>
                                <div class="calculator-buttons">
                                    <button class="calc-btn clear" data-calc="clear">C</button>
                                    <button class="calc-btn" data-calc="(">(</button>
                                    <button class="calc-btn" data-calc=")">)</button>
                                    <button class="calc-btn operator" data-calc="/">/</button>
                                    <button class="calc-btn" data-calc="7">7</button>
                                    <button class="calc-btn" data-calc="8">8</button>
                                    <button class="calc-btn" data-calc="9">9</button>
                                    <button class="calc-btn operator" data-calc="*">×</button>
                                    <button class="calc-btn" data-calc="4">4</button>
                                    <button class="calc-btn" data-calc="5">5</button>
                                    <button class="calc-btn" data-calc="6">6</button>
                                    <button class="calc-btn operator" data-calc="-">-</button>
                                    <button class="calc-btn" data-calc="1">1</button>
                                    <button class="calc-btn" data-calc="2">2</button>
                                    <button class="calc-btn" data-calc="3">3</button>
                                    <button class="calc-btn operator" data-calc="+">+</button>
                                    <button class="calc-btn" data-calc="0">0</button>
                                    <button class="calc-btn" data-calc=".">.</button>
                                    <button class="calc-btn equals" data-calc="=">=</button>
                                    <button class="calc-btn operator" data-calc="sqrt">√</button>
                                </div>
                            </div>
                            <a href="https://p2p.binance.com/trade/all-payments/USDT?fiat=VES" target="_blank" class="dollar-link">Precio del dólar hoy</a>
                        </div>
                        <div style="overflow-x: auto;">
                            <table id="expensesTable" class="table">
                                <thead>
                                    <tr>
                                        <th>Ingresos</th>
                                        <th>Cantidad</th>
                                        <th>Cantidad Total</th>
                                        <th>Egresos</th>
                                        <th>Egresos Total</th>
                                        <th>Gastos Operaciones</th>
                                        <th>Salarios</th>
                                        <th>Gastos Adm</th>
                                        <th>Mantenimiento</th>
                                        <th>Expansiones</th>
                                        <th>Mejoras</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Rows will be added dynamically -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Employees Tab -->
                    <div id="employeesTab" class="tab-content">
                        <h3>Registro de Empleados</h3>
                        <div class="tools-container">
                            <button id="addRowEmployees" class="btn btn-success">Agregar Fila</button>
                            <div class="calculator">
                                <input type="text" id="calcDisplayEmployees" class="calculator-display" readonly>
                                <div class="calculator-buttons">
                                    <button class="calc-btn clear" data-calc="clear">C</button>
                                    <button class="calc-btn" data-calc="(">(</button>
                                    <button class="calc-btn" data-calc=")">)</button>
                                    <button class="calc-btn operator" data-calc="/">/</button>
                                    <button class="calc-btn" data-calc="7">7</button>
                                    <button class="calc-btn" data-calc="8">8</button>
                                    <button class="calc-btn" data-calc="9">9</button>
                                    <button class="calc-btn operator" data-calc="*">×</button>
                                    <button class="calc-btn" data-calc="4">4</button>
                                    <button class="calc-btn" data-calc="5">5</button>
                                    <button class="calc-btn" data-calc="6">6</button>
                                    <button class="calc-btn operator" data-calc="-">-</button>
                                    <button class="calc-btn" data-calc="1">1</button>
                                    <button class="calc-btn" data-calc="2">2</button>
                                    <button class="calc-btn" data-calc="3">3</button>
                                    <button class="calc-btn operator" data-calc="+">+</button>
                                    <button class="calc-btn" data-calc="0">0</button>
                                    <button class="calc-btn" data-calc=".">.</button>
                                    <button class="calc-btn equals" data-calc="=">=</button>
                                    <button class="calc-btn operator" data-calc="sqrt">√</button>
                                </div>
                            </div>
                            <a href="https://p2p.binance.com/trade/all-payments/USDT?fiat=VES" target="_blank" class="dollar-link">Precio del dólar hoy</a>
                        </div>
                        <div style="overflow-x: auto;">
                            <table id="employeesTable" class="table">
                                <thead>
                                    <tr>
                                        <th>Empleado</th>
                                        <th>Días</th>
                                        <th>Noches</th>
                                        <th>Redobles</th>
                                        <th>Cargo</th>
                                        <th>Salario día</th>
                                        <th>Salario noche</th>
                                        <th>Redobles</th>
                                        <th>Día libre</th>
                                        <th>Descuentos</th>
                                        <th>Otros</th>
                                        <th>Fecha de inicio</th>
                                        <th>Fecha de finalización</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Rows will be added dynamically -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Change Password Tab -->
                    <div id="changePasswordTab" class="tab-content">
                        <h3>Cambiar Contraseña</h3>
                        <div class="form-group">
                            <label for="currentPassword">Contraseña Actual</label>
                            <input type="password" id="currentPassword" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="newPassword">Nueva Contraseña</label>
                            <input type="password" id="newPassword" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="confirmPassword">Confirmar Nueva Contraseña</label>
                            <input type="password" id="confirmPassword" class="form-control">
                        </div>
                        <button id="changePasswordBtn" class="btn">Cambiar Contraseña</button>
                    </div>
                    
                    <!-- Summary Tab -->
                    <div id="summaryTab" class="tab-content">
                        <h3>Resumen del Día</h3>
                        <div id="summaryContent" class="summary-section">
                            <p>El resumen se generará automáticamente al final del día (11:59 PM).</p>
                        </div>
                        <div id="downloadOptions" class="hidden">
                            <button id="downloadPDF" class="btn">Descargar PDF</button>
                            <button id="downloadExcel" class="btn">Descargar Excel</button>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <button id="logoutBtn" class="btn btn-danger">Cerrar Sesión</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification hidden"></div>

    <script>
        // User data
        const users = [
            { username: 'SrChinchilla', password: 'Chin+58414-5043504' },
            { username: 'SraChinchilla', password: 'Chin+58414-5043504' },
            { username: 'trabajador1', password: 'Chin+58414-5043504' },
            { username: 'trabajador2', password: 'Chin+58414-5043504' }
        ];

        // Get user data from localStorage or initialize
        let userData = JSON.parse(localStorage.getItem('userData')) || users.map(user => ({ ...user }));

        // Current user
        let currentUser = null;

        // DOM elements
        const loginSection = document.getElementById('loginSection');
        const mainSection = document.getElementById('mainSection');
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const loginBtn = document.getElementById('loginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const currentDateTime = document.getElementById('currentDateTime');
        const notification = document.getElementById('notification');
        const navTabs = document.querySelectorAll('.nav-tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const generalTable = document.getElementById('generalTable').querySelector('tbody');
        const expensesTable = document.getElementById('expensesTable').querySelector('tbody');
        const employeesTable = document.getElementById('employeesTable').querySelector('tbody');
        const addRowGeneralBtn = document.getElementById('addRowGeneral');
        const addRowExpensesBtn = document.getElementById('addRowExpenses');
        const addRowEmployeesBtn = document.getElementById('addRowEmployees');
        const changePasswordBtn = document.getElementById('changePasswordBtn');
        const downloadPDFBtn = document.getElementById('downloadPDF');
        const downloadExcelBtn = document.getElementById('downloadExcel');
        const summaryContent = document.getElementById('summaryContent');
        const downloadOptions = document.getElementById('downloadOptions');
        
        // Calculator elements
        const calcDisplayGeneral = document.getElementById('calcDisplayGeneral');
        const calcDisplayExpenses = document.getElementById('calcDisplayExpenses');
        const calcDisplayEmployees = document.getElementById('calcDisplayEmployees');
        
        // Calculator state
        let calcState = {
            general: {
                display: '0',
                firstOperand: null,
                waitingForSecondOperand: false,
                operator: null
            },
            expenses: {
                display: '0',
                firstOperand: null,
                waitingForSecondOperand: false,
                operator: null
            },
            employees: {
                display: '0',
                firstOperand: null,
                waitingForSecondOperand: false,
                operator: null
            }
        };

        // Initialize app
        function init() {
            // Load saved data
            loadGeneralData();
            loadExpensesData();
            loadEmployeesData();
            
            // Update date and time
            updateDateTime();
            setInterval(updateDateTime, 1000);
            
            // Check if it's time to generate daily summary
            checkDailySummary();
            setInterval(checkDailySummary, 60000); // Check every minute
            
            // Event listeners
            loginBtn.addEventListener('click', login);
            logoutBtn.addEventListener('click', logout);
            addRowGeneralBtn.addEventListener('click', () => addRow('general'));
            addRowExpensesBtn.addEventListener('click', () => addRow('expenses'));
            addRowEmployeesBtn.addEventListener('click', () => addRow('employees'));
            changePasswordBtn.addEventListener('click', changePassword);
            downloadPDFBtn.addEventListener('click', downloadPDF);
            downloadExcelBtn.addEventListener('click', downloadExcel);
            
            // Calculator event listeners
            setupCalculator('general');
            setupCalculator('expenses');
            setupCalculator('employees');
            
            // Tab navigation
            navTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');
                    switchTab(tabId);
                });
            });
        }

        // Setup calculator
        function setupCalculator(type) {
            const display = type === 'general' ? calcDisplayGeneral : 
                           type === 'expenses' ? calcDisplayExpenses : calcDisplayEmployees;
            const container = display.parentElement;
            const buttons = container.querySelectorAll('.calc-btn');
            
            buttons.forEach(button => {
                button.addEventListener('click', () => {
                    const calcValue = button.getAttribute('data-calc');
                    handleCalculator(type, calcValue);
                });
            });
        }

        // Handle calculator input
        function handleCalculator(type, value) {
            const state = calcState[type];
            const display = type === 'general' ? calcDisplayGeneral : 
                           type === 'expenses' ? calcDisplayExpenses : calcDisplayEmployees;
            
            if (value === 'clear') {
                state.display = '0';
                state.firstOperand = null;
                state.waitingForSecondOperand = false;
                state.operator = null;
            } else if (value === '.') {
                if (!state.display.includes('.')) {
                    state.display += '.';
                }
            } else if (value === 'sqrt') {
                state.display = String(Math.sqrt(parseFloat(state.display)));
            } else if (['+', '-', '*', '/'].includes(value)) {
                const inputValue = parseFloat(state.display);
                
                if (state.firstOperand === null) {
                    state.firstOperand = inputValue;
                } else if (state.operator) {
                    const result = performCalculation(state.operator, state.firstOperand, inputValue);
                    state.display = String(result);
                    state.firstOperand = result;
                }
                
                state.waitingForSecondOperand = true;
                state.operator = value;
            } else if (value === '=') {
                if (state.operator && state.firstOperand !== null) {
                    const inputValue = parseFloat(state.display);
                    const result = performCalculation(state.operator, state.firstOperand, inputValue);
                    state.display = String(result);
                    state.firstOperand = null;
                    state.operator = null;
                    state.waitingForSecondOperand = false;
                }
            } else if (['(', ')'].includes(value)) {
                // Handle parentheses (simplified implementation)
                state.display += value;
            } else {
                // Number input
                if (state.waitingForSecondOperand) {
                    state.display = value;
                    state.waitingForSecondOperand = false;
                } else {
                    state.display = state.display === '0' ? value : state.display + value;
                }
            }
            
            display.value = state.display;
        }

        // Perform calculation
        function performCalculation(operator, firstOperand, secondOperand) {
            switch (operator) {
                case '+':
                    return firstOperand + secondOperand;
                case '-':
                    return firstOperand - secondOperand;
                case '*':
                    return firstOperand * secondOperand;
                case '/':
                    return firstOperand / secondOperand;
                default:
                    return secondOperand;
            }
        }

        // Update date and time (Caracas time)
        function updateDateTime() {
            const now = new Date();
            // Caracas is UTC-4
            const caracasTime = new Date(now.toLocaleString("en-US", {timeZone: "America/Caracas"}));
            
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            };
            
            currentDateTime.textContent = caracasTime.toLocaleDateString('es-ES', options);
        }

        // Login function
        function login() {
            const username = usernameInput.value.trim();
            const password = passwordInput.value;
            
            if (!username || !password) {
                showNotification('Por favor ingrese usuario y contraseña', 'error');
                return;
            }
            
            const user = userData.find(u => u.username === username && u.password === password);
            
            if (user) {
                currentUser = user;
                loginSection.classList.add('hidden');
                mainSection.classList.remove('hidden');
                showNotification(`Bienvenido, ${username}`);
                
                // Clear form
                usernameInput.value = '';
                passwordInput.value = '';
            } else {
                showNotification('Usuario o contraseña incorrectos', 'error');
            }
        }

        // Logout function
        function logout() {
            currentUser = null;
            mainSection.classList.add('hidden');
            loginSection.classList.remove('hidden');
            showNotification('Sesión cerrada correctamente');
        }

        // Show notification
        function showNotification(message, type = 'success') {
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.remove('hidden');
            
            setTimeout(() => {
                notification.classList.add('hidden');
            }, 3000);
        }

        // Switch tab
        function switchTab(tabId) {
            navTabs.forEach(tab => {
                if (tab.getAttribute('data-tab') === tabId) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });
            
            tabContents.forEach(content => {
                if (content.id === `${tabId}Tab`) {
                    content.classList.add('active');
                } else {
                    content.classList.remove('active');
                }
            });
        }

        // Add row to table
        function addRow(tableType) {
            let table;
            if (tableType === 'general') {
                table = generalTable;
            } else if (tableType === 'expenses') {
                table = expensesTable;
            } else if (tableType === 'employees') {
                table = employeesTable;
            }
            
            const row = document.createElement('tr');
            
            if (tableType === 'general') {
                row.innerHTML = `
                    <td><input type="text" class="form-control" placeholder="Material"></td>
                    <td><input type="text" class="form-control" placeholder="Tipo"></td>
                    <td><input type="number" class="form-control" placeholder="Cantidad"></td>
                    <td><input type="number" class="form-control" placeholder="Precio"></td>
                    <td><input type="text" class="form-control" placeholder="Recibido por"></td>
                    <td><input type="text" class="form-control" placeholder="Dentino final"></td>
                    <td><input type="number" class="form-control" placeholder="Precio Ves"></td>
                    <td><input type="number" class="form-control" placeholder="Precio USD"></td>
                    <td><button class="btn btn-danger delete-row">Eliminar</button></td>
                `;
            } else if (tableType === 'expenses') {
                row.innerHTML = `
                    <td><input type="text" class="form-control" placeholder="Ingresos"></td>
                    <td><input type="number" class="form-control" placeholder="Cantidad"></td>
                    <td><input type="number" class="form-control" placeholder="Cantidad Total"></td>
                    <td><input type="text" class="form-control" placeholder="Egresos"></td>
                    <td><input type="number" class="form-control" placeholder="Egresos Total"></td>
                    <td><input type="number" class="form-control" placeholder="Gastos Operaciones"></td>
                    <td><input type="number" class="form-control" placeholder="Salarios"></td>
                    <td><input type="number" class="form-control" placeholder="Gastos Adm"></td>
                    <td><input type="number" class="form-control" placeholder="Mantenimiento"></td>
                    <td><input type="number" class="form-control" placeholder="Expansiones"></td>
                    <td><input type="number" class="form-control" placeholder="Mejoras"></td>
                    <td><button class="btn btn-danger delete-row">Eliminar</button></td>
                `;
            } else if (tableType === 'employees') {
                row.innerHTML = `
                    <td><input type="text" class="form-control" placeholder="Empleado"></td>
                    <td><input type="number" class="form-control" placeholder="Días"></td>
                    <td><input type="number" class="form-control" placeholder="Noches"></td>
                    <td><input type="number" class="form-control" placeholder="Redobles"></td>
                    <td><input type="text" class="form-control" placeholder="Cargo"></td>
                    <td><input type="number" class="form-control" placeholder="Salario día"></td>
                    <td><input type="number" class="form-control" placeholder="Salario noche"></td>
                    <td><input type="number" class="form-control" placeholder="Redobles"></td>
                    <td><input type="text" class="form-control" placeholder="Día libre"></td>
                    <td><input type="number" class="form-control" placeholder="Descuentos"></td>
                    <td><input type="number" class="form-control" placeholder="Otros"></td>
                    <td><input type="date" class="form-control"></td>
                    <td><input type="date" class="form-control"></td>
                    <td><button class="btn btn-danger delete-row">Eliminar</button></td>
                `;
            }
            
            table.appendChild(row);
            
            // Add event listener to delete button
            row.querySelector('.delete-row').addEventListener('click', function() {
                row.remove();
                saveData(tableType);
            });
            
            // Add event listeners to inputs for auto-save
            const inputs = row.querySelectorAll('input');
            inputs.forEach(input => {
                input.addEventListener('change', () => saveData(tableType));
            });
            
            saveData(tableType);
        }

        // Save data to localStorage
        function saveData(tableType) {
            if (tableType === 'general') {
                const rows = [];
                generalTable.querySelectorAll('tr').forEach(row => {
                    const rowData = [];
                    row.querySelectorAll('input').forEach(input => {
                        rowData.push(input.value);
                    });
                    if (rowData.length > 0) {
                        rows.push(rowData);
                    }
                });
                localStorage.setItem('generalData', JSON.stringify(rows));
            } else if (tableType === 'expenses') {
                const rows = [];
                expensesTable.querySelectorAll('tr').forEach(row => {
                    const rowData = [];
                    row.querySelectorAll('input').forEach(input => {
                        rowData.push(input.value);
                    });
                    if (rowData.length > 0) {
                        rows.push(rowData);
                    }
                });
                localStorage.setItem('expensesData', JSON.stringify(rows));
            } else if (tableType === 'employees') {
                const rows = [];
                employeesTable.querySelectorAll('tr').forEach(row => {
                    const rowData = [];
                    row.querySelectorAll('input').forEach(input => {
                        rowData.push(input.value);
                    });
                    if (rowData.length > 0) {
                        rows.push(rowData);
                    }
                });
                localStorage.setItem('employeesData', JSON.stringify(rows));
            }
        }

        // Load data from localStorage
        function loadGeneralData() {
            const data = JSON.parse(localStorage.getItem('generalData')) || [];
            data.forEach(rowData => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><input type="text" class="form-control" value="${rowData[0] || ''}"></td>
                    <td><input type="text" class="form-control" value="${rowData[1] || ''}"></td>
                    <td><input type="number" class="form-control" value="${rowData[2] || ''}"></td>
                    <td><input type="number" class="form-control" value="${rowData[3] || ''}"></td>
                    <td><input type="text" class="form-control" value="${rowData[4] || ''}"></td>
                    <td><input type="text" class="form-control" value="${rowData[5] || ''}"></td>
                    <td><input type="number" class="form-control" value="${rowData[6] || ''}"></td>
                    <td><input type="number" class="form-control" value="${rowData[7] || ''}"></td>
                    <td><button class="btn btn-danger delete-row">Eliminar</button></td>
                `;
                generalTable.appendChild(row);
                
                // Add event listener to delete button
                row.querySelector('.delete-row').addEventListener('click', function() {
                    row.remove();
                    saveData('general');
                });
                
                // Add event listeners to inputs for auto-save
                const inputs = row.querySelectorAll('input');
                inputs.forEach(input => {
                    input.addEventListener('change', () => saveData('general'));
                });
            });
        }

        function loadExpensesData() {
            const data = JSON.parse(localStorage.getItem('expensesData')) || [];
            data.forEach(rowData => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><input type="text" class="form-control" value="${rowData[0] || ''}"></td>
                    <td><input type="number" class="form-control" value="${rowData[1] || ''}"></td>
                    <td><input type="number" class="form-control" value="${rowData[2] || ''}"></td>
                    <td><input type="text" class="form-control" value="${rowData[3] || ''}"></td>
                    <td><input type="number" class="form-control" value="${rowData[4] || ''}"></td>
                    <td><input type="number" class="form-control" value="${rowData[5] || ''}"></td>
                    <td><input type="number" class="form-control" value="${rowData[6] || ''}"></td>
                    <td><input type="number" class="form-control" value="${rowData[7] || ''}"></td>
                    <td><input type="number" class="form-control" value="${rowData[8] || ''}"></td>
                    <td><input type="number" class="form-control" value="${rowData[9] || ''}"></td>
                    <td><input type="number" class="form-control" value="${rowData[10] || ''}"></td>
                    <td><button class="btn btn-danger delete-row">Eliminar</button></td>
                `;
                expensesTable.appendChild(row);
                
                // Add event listener to delete button
                row.querySelector('.delete-row').addEventListener('click', function() {
                    row.remove();
                    saveData('expenses');
                });
                
                // Add event listeners to inputs for auto-save
                const inputs = row.querySelectorAll('input');
                inputs.forEach(input => {
                    input.addEventListener('change', () => saveData('expenses'));
                });
            });
        }

        function loadEmployeesData() {
            const data = JSON.parse(localStorage.getItem('employeesData')) || [];
            data.forEach(rowData => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><input type="text" class="form-control" value="${rowData[0] || ''}"></td>
                    <td><input type="number" class="form-control" value="${rowData[1] || ''}"></td>
                    <td><input type="number" class="form-control" value="${rowData[2] || ''}"></td>
                    <td><input type="number" class="form-control" value="${rowData[3] || ''}"></td>
                    <td><input type="text" class="form-control" value="${rowData[4] || ''}"></td>
                    <td><input type="number" class="form-control" value="${rowData[5] || ''}"></td>
                    <td><input type="number" class="form-control" value="${rowData[6] || ''}"></td>
                    <td><input type="number" class="form-control" value="${rowData[7] || ''}"></td>
                    <td><input type="text" class="form-control" value="${rowData[8] || ''}"></td>
                    <td><input type="number" class="form-control" value="${rowData[9] || ''}"></td>
                    <td><input type="number" class="form-control" value="${rowData[10] || ''}"></td>
                    <td><input type="date" class="form-control" value="${rowData[11] || ''}"></td>
                    <td><input type="date" class="form-control" value="${rowData[12] || ''}"></td>
                    <td><button class="btn btn-danger delete-row">Eliminar</button></td>
                `;
                employeesTable.appendChild(row);
                
                // Add event listener to delete button
                row.querySelector('.delete-row').addEventListener('click', function() {
                    row.remove();
                    saveData('employees');
                });
                
                // Add event listeners to inputs for auto-save
                const inputs = row.querySelectorAll('input');
                inputs.forEach(input => {
                    input.addEventListener('change', () => saveData('employees'));
                });
            });
        }

        // Change password
        function changePassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (!currentPassword || !newPassword || !confirmPassword) {
                showNotification('Por favor complete todos los campos', 'error');
                return;
            }
            
            if (currentPassword !== currentUser.password) {
                showNotification('La contraseña actual es incorrecta', 'error');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showNotification('Las nuevas contraseñas no coinciden', 'error');
                return;
            }
            
            // Update user password
            const userIndex = userData.findIndex(u => u.username === currentUser.username);
            if (userIndex !== -1) {
                userData[userIndex].password = newPassword;
                currentUser.password = newPassword;
                localStorage.setItem('userData', JSON.stringify(userData));
                
                // Clear form
                document.getElementById('currentPassword').value = '';
                document.getElementById('newPassword').value = '';
                document.getElementById('confirmPassword').value = '';
                
                showNotification('Contraseña cambiada correctamente');
            }
        }

        // Check if it's time to generate daily summary
        function checkDailySummary() {
            const now = new Date();
            // Caracas is UTC-4
            const caracasTime = new Date(now.toLocaleString("en-US", {timeZone: "America/Caracas"}));
            
            // Check if it's 11:59 PM
            if (caracasTime.getHours() === 23 && caracasTime.getMinutes() === 59) {
                generateDailySummary();
            }
        }

        // Generate daily summary
        function generateDailySummary() {
            const today = new Date();
            const dateStr = today.toLocaleDateString('es-ES');
            
            // Get data from tables
            const generalData = JSON.parse(localStorage.getItem('generalData')) || [];
            const expensesData = JSON.parse(localStorage.getItem('expensesData')) || [];
            const employeesData = JSON.parse(localStorage.getItem('employeesData')) || [];
            
            // Calculate totals
            let totalGeneral = 0;
            let totalExpenses = 0;
            let totalEmployees = 0;
            
            generalData.forEach(row => {
                const price = parseFloat(row[7]) || 0; // Price USD
                totalGeneral += price;
            });
            
            expensesData.forEach(row => {
                const expensesTotal = parseFloat(row[4]) || 0; // Egresos Total
                totalExpenses += expensesTotal;
            });
            
            employeesData.forEach(row => {
                const salaryDay = parseFloat(row[5]) || 0; // Salario día
                const salaryNight = parseFloat(row[6]) || 0; // Salario noche
                const redobles = parseFloat(row[7]) || 0; // Redobles
                const discounts = parseFloat(row[9]) || 0; // Descuentos
                const others = parseFloat(row[10]) || 0; // Otros
                
                const totalEmployee = (salaryDay + salaryNight + redobles) - (discounts + others);
                totalEmployees += totalEmployee;
            });
            
            // Create summary
            const summary = `
                <div class="summary-title">Resumen del día ${dateStr}</div>
                <p><strong>Total de ingresos:</strong> $${totalGeneral.toFixed(2)}</p>
                <p><strong>Total de egresos:</strong> $${totalExpenses.toFixed(2)}</p>
                <p><strong>Total de salarios:</strong> $${totalEmployees.toFixed(2)}</p>
                <p><strong>Balance del día:</strong> $${(totalGeneral - totalExpenses - totalEmployees).toFixed(2)}</p>
                <p><strong>Número de registros generales:</strong> ${generalData.length}</p>
                <p><strong>Número de registros de gastos:</strong> ${expensesData.length}</p>
                <p><strong>Número de registros de empleados:</strong> ${employeesData.length}</p>
            `;
            
            summaryContent.innerHTML = summary;
            downloadOptions.classList.remove('hidden');
            
            // Save summary to localStorage
            const summaries = JSON.parse(localStorage.getItem('dailySummaries')) || [];
            summaries.push({
                date: dateStr,
                summary: summary,
                generalData: generalData,
                expensesData: expensesData,
                employeesData: employeesData,
                totalGeneral: totalGeneral,
                totalExpenses: totalExpenses,
                totalEmployees: totalEmployees
            });
            localStorage.setItem('dailySummaries', JSON.stringify(summaries));
            
            // Show notification
            showNotification('Resumen diario generado correctamente');
            
            // Clear tables for new day
            generalTable.innerHTML = '';
            expensesTable.innerHTML = '';
            employeesTable.innerHTML = '';
            localStorage.removeItem('generalData');
            localStorage.removeItem('expensesData');
            localStorage.removeItem('employeesData');
        }

        // Download PDF (simplified - in a real app you would use a library like jsPDF)
        function downloadPDF() {
            const summaries = JSON.parse(localStorage.getItem('dailySummaries')) || [];
            if (summaries.length === 0) {
                showNotification('No hay resúmenes disponibles para descargar', 'warning');
                return;
            }
            
            const lastSummary = summaries[summaries.length - 1];
            let content = `
                <html>
                <head>
                    <title>Resumen Diario</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; background-color: #50514F; color: #ffffff; }
                        h1 { color: #6BBE66; }
                        h2 { color: #6BBE66; }
                        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                        th, td { border: 1px solid #6BBE66; padding: 8px; text-align: left; }
                        th { background-color: #6BBE66; color: #50514F; }
                        tr:nth-child(even) { background-color: rgba(107, 190, 102, 0.1); }
                    </style>
                </head>
                <body>
                    <h1>Resumen Diario - ${lastSummary.date}</h1>
                    <p><strong>Total de ingresos:</strong> $${lastSummary.totalGeneral.toFixed(2)}</p>
                    <p><strong>Total de egresos:</strong> $${lastSummary.totalExpenses.toFixed(2)}</p>
                    <p><strong>Total de salarios:</strong> $${lastSummary.totalEmployees.toFixed(2)}</p>
                    <p><strong>Balance del día:</strong> $${(lastSummary.totalGeneral - lastSummary.totalExpenses - lastSummary.totalEmployees).toFixed(2)}</p>
                    
                    <h2>Registros Generales</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>Material</th>
                                <th>Tipo</th>
                                <th>Cantidad</th>
                                <th>Precio</th>
                                <th>Recibido por</th>
                                <th>Dentino final</th>
                                <th>Precio Ves</th>
                                <th>Precio USD</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            lastSummary.generalData.forEach(row => {
                content += `
                    <tr>
                        <td>${row[0] || ''}</td>
                        <td>${row[1] || ''}</td>
                        <td>${row[2] || ''}</td>
                        <td>${row[3] || ''}</td>
                        <td>${row[4] || ''}</td>
                        <td>${row[5] || ''}</td>
                        <td>${row[6] || ''}</td>
                        <td>${row[7] || ''}</td>
                    </tr>
                `;
            });
            
            content += `
                        </tbody>
                    </table>
                    
                    <h2>Registros de Gastos</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>Ingresos</th>
                                <th>Cantidad</th>
                                <th>Cantidad Total</th>
                                <th>Egresos</th>
                                <th>Egresos Total</th>
                                <th>Gastos Operaciones</th>
                                <th>Salarios</th>
                                <th>Gastos Adm</th>
                                <th>Mantenimiento</th>
                                <th>Expansiones</th>
                                <th>Mejoras</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            lastSummary.expensesData.forEach(row => {
                content += `
                    <tr>
                        <td>${row[0] || ''}</td>
                        <td>${row[1] || ''}</td>
                        <td>${row[2] || ''}</td>
                        <td>${row[3] || ''}</td>
                        <td>${row[4] || ''}</td>
                        <td>${row[5] || ''}</td>
                        <td>${row[6] || ''}</td>
                        <td>${row[7] || ''}</td>
                        <td>${row[8] || ''}</td>
                        <td>${row[9] || ''}</td>
                        <td>${row[10] || ''}</td>
                    </tr>
                `;
            });
            
            content += `
                        </tbody>
                    </table>
                    
                    <h2>Registros de Empleados</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>Empleado</th>
                                <th>Días</th>
                                <th>Noches</th>
                                <th>Redobles</th>
                                <th>Cargo</th>
                                <th>Salario día</th>
                                <th>Salario noche</th>
                                <th>Redobles</th>
                                <th>Día libre</th>
                                <th>Descuentos</th>
                                <th>Otros</th>
                                <th>Fecha de inicio</th>
                                <th>Fecha de finalización</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            lastSummary.employeesData.forEach(row => {
                content += `
                    <tr>
                        <td>${row[0] || ''}</td>
                        <td>${row[1] || ''}</td>
                        <td>${row[2] || ''}</td>
                        <td>${row[3] || ''}</td>
                        <td>${row[4] || ''}</td>
                        <td>${row[5] || ''}</td>
                        <td>${row[6] || ''}</td>
                        <td>${row[7] || ''}</td>
                        <td>${row[8] || ''}</td>
                        <td>${row[9] || ''}</td>
                        <td>${row[10] || ''}</td>
                        <td>${row[11] || ''}</td>
                        <td>${row[12] || ''}</td>
                    </tr>
                `;
            });
            
            content += `
                        </tbody>
                    </table>
                </body>
                </html>
            `;
            
            const blob = new Blob([content], { type: 'application/pdf' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `resumen_${lastSummary.date.replace(/\//g, '-')}.pdf`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('PDF descargado correctamente');
        }

        // Download Excel (simplified - in a real app you would use a library like SheetJS)
        function downloadExcel() {
            const summaries = JSON.parse(localStorage.getItem('dailySummaries')) || [];
            if (summaries.length === 0) {
                showNotification('No hay resúmenes disponibles para descargar', 'warning');
                return;
            }
            
            const lastSummary = summaries[summaries.length - 1];
            let csvContent = "data:text/csv;charset=utf-8,";
            
            // Add summary info
            csvContent += `Resumen Diario - ${lastSummary.date}\n\n`;
            csvContent += `Total de ingresos,${lastSummary.totalGeneral.toFixed(2)}\n`;
            csvContent += `Total de egresos,${lastSummary.totalExpenses.toFixed(2)}\n`;
            csvContent += `Total de salarios,${lastSummary.totalEmployees.toFixed(2)}\n`;
            csvContent += `Balance del día,${(lastSummary.totalGeneral - lastSummary.totalExpenses - lastSummary.totalEmployees).toFixed(2)}\n\n`;
            
            // Add general data
            csvContent += "Registros Generales\n";
            csvContent += "Material,Tipo,Cantidad,Precio,Recibido por,Dentino final,Precio Ves,Precio USD\n";
            
            lastSummary.generalData.forEach(row => {
                csvContent += `${row[0] || ''},${row[1] || ''},${row[2] || ''},${row[3] || ''},${row[4] || ''},${row[5] || ''},${row[6] || ''},${row[7] || ''}\n`;
            });
            
            csvContent += "\n";
            
            // Add expenses data
            csvContent += "Registros de Gastos\n";
            csvContent += "Ingresos,Cantidad,Cantidad Total,Egresos,Egresos Total,Gastos Operaciones,Salarios,Gastos Adm,Mantenimiento,Expansiones,Mejoras\n";
            
            lastSummary.expensesData.forEach(row => {
                csvContent += `${row[0] || ''},${row[1] || ''},${row[2] || ''},${row[3] || ''},${row[4] || ''},${row[5] || ''},${row[6] || ''},${row[7] || ''},${row[8] || ''},${row[9] || ''},${row[10] || ''}\n`;
            });
            
            csvContent += "\n";
            
            // Add employees data
            csvContent += "Registros de Empleados\n";
            csvContent += "Empleado,Días,Noches,Redobles,Cargo,Salario día,Salario noche,Redobles,Día libre,Descuentos,Otros,Fecha de inicio,Fecha de finalización\n";
            
            lastSummary.employeesData.forEach(row => {
                csvContent += `${row[0] || ''},${row[1] || ''},${row[2] || ''},${row[3] || ''},${row[4] || ''},${row[5] || ''},${row[6] || ''},${row[7] || ''},${row[8] || ''},${row[9] || ''},${row[10] || ''},${row[11] || ''},${row[12] || ''}\n`;
            });
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `resumen_${lastSummary.date.replace(/\//g, '-')}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Excel descargado correctamente');
        }

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
